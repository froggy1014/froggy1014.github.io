---
sidebar_position: 1
title: Docker & Kubernetes 실전 가이드
last_update:
  date: 4/02/2025
tags: [스터디]
description: 유데미에서 진행하는 Docker & 쿠버네티스 스터디 진행 및 정리ㅎ
---

![](https://i.ibb.co/yBdkqVRy/docker.png)

## 개요

### [Docker란](https://www.docker.com/why-docker/) ?

Docker is a platform designed to help developers build, share, and run container applications.

> Docker는 개발자가 컨테이너 애플리케이션을 빌드, 공유 및 실행할 수 있도록 도와주는 `플랫폼(도구)` 입니다.

### [컨테이너란](https://www.docker.com/resources/what-container/)?

- 애플리케이션 실행에 필요한 모든 것(코드, 런타임, 시스템 도구, 라이브러리)을 하나로 묶은 패키지
- 어떤 환경에서든 동일하게 실행되는 독립적인 실행 단위

### 컨테이너를 사용하는 이유 ?

컨테이너를 사용하는 이유는 여러 가지가 있지만, 가장 중요한 이유 중 하나는 환경의 일관성을 유지할 수 있기 때문입니다.

`e.g` `await`와 같은 최신 JavaScript 기능은 특정 Node.js 14 버전부터 지원됩니다. 노드 버전을 통일하지 않으면 문제가 발생하겠죠.

컨테이너를 사용하면 모든 개발자가 동일한 환경에서 작업할 수 있어 이러한 문제를 방지할 수 있습니다.
이는 `"내 컴퓨터에서는 잘 되는데..."`라는 문제를 해결하고, 개발, 테스트, 프로덕션 환경에서 동일한 실행 결과를 보장합니다.

import Admonition from "@theme/Admonition";

<Admonition type="tip" icon="❓" title="그러면 가상머신으로는 ?">
  위와 같은 상황이라면 가상머신으로도 대체할 수 있는게 아닐까요 ? 그에 대한 답은
  아래 비교를 보면 알 수 있습니다.
</Admonition>

### 컨테이너와 가상 머신 비교

| Docker 컨테이너                                                                          | 가상 머신                                                                          |
| ---------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------- |
| 운영 체제에 미치는 영향이 적고, 매우 빠르며, 디스크 공간 사용이 최소화됨                 | 운영 체제에 미치는 영향이 크고, 느리며, 디스크 공간 사용이 많음                    |
| 공유, 재구축 및 배포가 용이함                                                            | 공유, 재구축 및 배포가 어려울 수 있음                                              |
| 애플리케이션의 코드, 라이브러리 및 기타 종속 구성 요소를 포함하는 소프트웨어 코드 패키지 | 동일한 호스트 운영 체제에서 고유한 개별 운영 체제가 실행되는 여러 가상 머신을 보유 |

> 둘의 차이점을 요약하면: <br/>
> • 컨테이너는 애플리케이션 수준에서 격리되어 경량화되어 있으며, 여러 개의 컨테이너가 동일한 운영체제를 공유합니다. <br/>
> • 가상머신은 하드웨어 수준에서 격리되어 독립적인 운영체제를 갖고, 더 많은 자원을 소모합니다.

### 그렇다면 가상머신은 언제사용할까 ?

1. 서로 다른 운영 체제 환경에서 작업해야 할 때 <br/>
   `e.g` “Windows와 Linux 환경에서 동시에 다양한 애플리케이션을 실행하여 서로 다른 OS를 독립적으로 운영할 때.”

2. 고립된 테스트 환경이 필요할 때: <br/>
   `e.g` “새로운 소프트웨어 버전이나 보안 패치를 테스트하면서 호스트 시스템에 영향을 미치지 않도록 격리된 환경을 제공할 때.”

3. 하드웨어 가상화가 필요한 경우: <br/>
   `e.g` “GPU를 활용한 AI 모델 학습이나 하드웨어 가속이 필요한 작업을 다양한 운영 체제에서 테스트하고 실행할 때.”

etc...

### [Docker 설치 버그](https://github.com/docker/for-mac/issues/7520) - 2025

현재 Docker를 설치하면 아래와 같은 팝업이 무한정 반복되는 것을 확인 할 수 있습니다.

![docker-installtion-fail](https://i.ibb.co/3ykShTgP/Screenshot-2025-02-05-at-00-05-14.png)

많은 솔루션이 제시되었지만 제 맥북 스펙에는 아래와 같은 [솔루션](https://forums.docker.com/t/malware-blocked-com-docker-vmnetd-was-not-opened-because-it-contains-malware/145930/39)을 통해 해결했습니다.

| 항목      | 사양               |
| --------- | ------------------ |
| 모델      | MacBook Air        |
| 화면 크기 | 15-inch            |
| 칩        | Apple M2           |
| 메모리    | 24 GB              |
| 운영체제  | macOS Sequoia 15.1 |

- [AWS - 컨테이너와 가상 머신의 차이점은 무엇인가요?](https://aws.amazon.com/ko/compare/the-difference-between-containers-and-virtual-machines/)

---

## 이미지와 컨테이너

:::info

**이미지**: 도커 이미지란 애플리케이션을 실행하는 데 필요한 파일과 설정을 포함하는 읽기 전용 템플릿입니다. 이미지는 컨테이너를 생성하는 데 사용되며, 동일한 이미지를 사용하여 여러 개의 컨테이너를 만들 수 있습니다.

**컨테이너**: 도커 컨테이너는 이미지로부터 생성된 실행 가능한 인스턴스입니다. 컨테이너는 애플리케이션과 그 종속성을 포함하며, 격리된 환경에서 실행됩니다. 컨테이너는 가볍고 빠르게 시작할 수 있으며, 필요에 따라 쉽게 생성하고 삭제할 수 있습니다.

:::

### DockerFile

```
# Docker Hub에서 공식 Node.js 이미지를 사용합니다
FROM node

# 컨테이너 내부의 작업 디렉토리를 /app으로 설정합니다
WORKDIR /app

# 호스트에서 package.json 파일을 컨테이너의 작업 디렉토리로 복사합니다
COPY package.json /app

# package.json 파일에 지정된 종속성을 설치합니다
RUN npm install

# 호스트에서 애플리케이션 코드를 컨테이너의 작업 디렉토리로 복사합니다
COPY . ./app

# 애플리케이션에 외부 접근을 허용하기 위해 포트 80을 노출합니다
EXPOSE 80

# 애플리케이션을 실행하기 위한 명령을 정의합니다
CMD ["node", "server.js"]
```

### Docker Layer

도커는 위와 같은 `DockerFile` 파일의 적힌 명령 순서대로 build를 수행하게 된다.
모든 명령에 레이어를 만들지는 않고, 파일 시스템에 변화가 생기는 `ADD`, `COPY`, `RUN` 같은 경우만 생성한다.

![](https://blog.kakaocdn.net/dn/czfjyz/btsIsfUKgbT/xOu7ElV9AIllRGv7xtOkH0/img.png)

### Docker Cache

매번 빌드하면 당연히 속도가 느려지는데, 이때 Docker는 각 레이어에 변경 사항이 없다면 기존 레이어를 재사용하여, 빌드를 최적화한다.
해당 레이어에 변경사항이 있다면 해당 레이어를 기준으로 아래에 있는 레이어는 캐시가 무효화가 된다.

그렇기 때문에 자주 변경되는 레이어는 제일 마지막에 두는게 좋다.

- [Docker Build Cache](https://docs.docker.com/build/cache/)

### Attach와 Detach 모드

Docker 컨테이너는 `Attach` 모드와 `Detach` 모드로 실행할 수 있습니다.

**Attach 모드**:

- 컨테이너의 stdout과 stderr가 터미널에 연결됩니다.
- 입력을 받으려면 `-it` 플래그를 사용합니다.
- 예시:
  ```
  docker run -it <image_name>
  ```

**Detach 모드**:

- 컨테이너가 백그라운드에서 실행됩니다.
- 터미널은 즉시 반환되며, 로그는 `docker logs`로 확인합니다.
- 예시:
  ```
  docker run -d <image_name>
  ```


### 중지된 컨테이너 자동 제거

Docker는 중지된 컨테이너를 자동으로 제거할 수 있는 옵션을 제공합니다. 이를 통해 시스템 자원을 효율적으로 관리할 수 있습니다.

**--rm 옵션 사용**:

- `docker run` 명령어에 `--rm` 옵션을 추가하면, 컨테이너가 중지될 때 자동으로 제거됩니다.
- 예시:
  ```
  docker run --rm <image_name>
  ```

이 옵션을 사용하면, 컨테이너가 종료된 후 수동으로 제거할 필요가 없어집니다. 이는 특히 테스트나 일회성 작업에 유용합니다.


:::tip
[Docker CLI CheatSheet](https://docs.docker.com/get-started/docker_cheatsheet.pdf)
:::

### 이미지 저장소

- [**Docker Hub**](https://hub.docker.com/): 공식적인 이미지 저장소, 공개 및 일부 개인 저장소 가능 
- **Private Registry**: 특정 팀 또는 조직 내에서만 사용 가능한 이미지 저장소


